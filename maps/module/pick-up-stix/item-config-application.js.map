{"version":3,"sources":["module/pick-up-stix/item-config-application.ts"],"names":[],"mappings":"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","file":"../../../src/module/pick-up-stix/item-config-application.js","sourcesContent":["//@ts-ignore\r\nimport { DND5E } from \"../../../../systems/dnd5e/module/config.js\";\r\nimport ContainerImageSelectionApplication from \"../container-image-selection-application\";\r\nimport { createOwnedEntity, itemCollected, updateActor, currencyCollected, updateToken } from './main';\r\nimport { ItemType } from \"./models\";\r\n\r\n/**\r\n * Application class to display to select an item that the token is\r\n * associated with\r\n */\r\nexport default class ItemConfigApplication extends FormApplication {\r\n\tprivate _tokenUpdateHandler;\r\n\tprivate _tokenDeletedHandler;\r\n\tprivate _html: any;\r\n\r\n\t/**\r\n\t * This is an object of the loot that this container holds. The keys are the loot type\r\n\t * `weapon`, `equipment`, `consumable`, `backpack`, `tool`, `loot`. The values will\r\n\t * be an array of Item instance data\r\n\t */\r\n\tprivate _loot: {\r\n\t\t[key: string]: any[];\r\n\t};\r\n\r\n\tstatic get defaultOptions(): ApplicationOptions {\r\n\t\treturn mergeObject(super.defaultOptions, {\r\n\t\t\tcloseOnSubmit: false,\r\n\t\t\tsubmitOnClose: false,\r\n\t\t\tsubmitOnChange: true,\r\n\t\t\tid: \"pick-up-stix-item-config\",\r\n\t\t\ttemplate: \"modules/pick-up-stix/module/pick-up-stix/templates/item-config.html\",\r\n\t\t\twidth: 500,\r\n\t\t\theight: 'auto',\r\n\t\t\tminimizable: false,\r\n\t\t\ttitle: `${game.user.isGM ? 'Configure Loot Container' : 'Loot Container'}`,\r\n\t\t\tresizable: true,\r\n\t\t\tclasses: ['dnd5e', 'sheet', 'actor', 'character'],\r\n\t\t\tdragDrop: [{ dropSelector: null }]\r\n\t\t});\r\n\t}\r\n\r\n\tconstructor(private _token: Token) {\r\n\t\tsuper({});\r\n\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId} | constructor called with:`)\r\n\t\tconsole.log(this._token);\r\n\t\tthis._loot = {\r\n\t\t\tcurrency: Object.keys(DND5E.currencies).reduce((prev, k) => { prev[k] = 0; return prev; }, {}),\r\n\t\t\t...duplicate(this._token.getFlag('pick-up-stix', 'pick-up-stix.containerLoot') ?? {})\r\n\t\t}\r\n\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId} | constructor | initial loot:`);\r\n\t\tconsole.log(this._loot);\r\n\t\tthis._tokenUpdateHandler = this._tokenUpdated.bind(this);\r\n\t\tthis._tokenDeletedHandler = this._tokenDeleted.bind(this);\r\n\t\tHooks.on('updateToken', this._tokenUpdateHandler);\r\n\t\tHooks.on('deleteToken', this._tokenDeletedHandler);\r\n\t}\r\n\r\n\tprotected _tokenDeleted(scene: Scene, tokenData: any, data: any, userId: string) {\r\n\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId} | _tokenDeleted called with args:`);\r\n\t\tconsole.log([scene, tokenData, data, userId]);\r\n\r\n\t\tif (tokenData._id === this._token.id) {\r\n\t\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId} | _tokenDeleted | token ID matches this app's token`)\r\n\t\t\tthis.close();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _tokenUpdated(scene, data, flags, options, userId) {\r\n\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId}  | _tokenUpdated called with args:`);\r\n\t\tconsole.log([scene, data, flags, options, userId]);\r\n\r\n\t\tif (data._id === this._token.id) {\r\n\t\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId}  | _tokenUpdated | token has been updated, re-render`);\r\n\t\t\tthis._loot = duplicate(this._token.getFlag('pick-up-stix', 'pick-up-stix.containerLoot') ?? {});\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t}\r\n\r\n\tactivateListeners(html) {\r\n\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId}  | activateListeners`);\r\n\t\tthis._html = html;\r\n\t\tsuper.activateListeners(this._html);\r\n\r\n\t\t// set the click listener on the image\r\n\t\t$(html).find(`[data-edit=\"img\"]`).click(e => this._onEditImage(e));\r\n\r\n\t\t// set click listeners on the buttons to pick up individual items\r\n\t\t$(html).find(`a.item-take`).click(e => this._onTakeItem(e));\r\n\r\n\t\t// set click listener for taking currency\r\n\t\t$(html).find(`a.currency-take`).click(e => this._onTakeCurrency(e));\r\n\r\n\t\t$(html).find('[data-currency-input]').prop('readonly', !game.user.isGM);\r\n\r\n\t\tif (!game.user.isGM) {\r\n\t\t\tconsole.log($(html).find('input[type=\"text\"].currency-input'));\r\n\t\t\t$(html).find('input[type=\"text\"].currency-input').addClass('isNotGM');\r\n\t\t}\r\n\t}\r\n\r\n\tgetData() {\r\n\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId}  | getData:`);\r\n\t\tconst data = {\r\n\t\t\tobject: this._token.data,\r\n\t\t\tcontainerDescription: getProperty(this._token.data, 'flags.pick-up-stix.pick-up-stix.initialState.itemData.data.description.value')?.replace(/font-size:\\s*\\d*.*;/, 'font-size: 16px;') ?? '',\r\n\t\t\tlootTypes: Object.keys(this._loot).filter(k => k !== 'currency'),\r\n\t\t\tloot: this._loot,\r\n\t\t\tcurrencyTypes: Object.entries(DND5E.currencies).map(([k, v]) => ({ short: k, long: v })),\r\n\t\t\tuser: game.user\r\n\t\t};\r\n\t\tconsole.log(data);\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprotected async _onTakeCurrency(e) {\r\n\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId} | _onTakeCurrency`);\r\n\t\tconst token: Token = canvas.tokens.controlled?.[0];\r\n\t\tconst actor: Actor = token.actor;\r\n\t\tif (!token || !actor) {\r\n\t\t\tui.notifications.error('You must be controlling only one token to pick up an item');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst currentCurrency = { ...getProperty(actor, 'data.data.currency') };\r\n\t\tconst lootCurrencies = this._loot['currency'];\r\n\t\tObject.keys(currentCurrency).forEach(k => currentCurrency[k] = +currentCurrency[k] + +lootCurrencies[k]);\r\n\t\tawait updateActor(actor, {'data.currency': currentCurrency});\r\n\r\n\t\tcurrencyCollected(token, Object.entries(lootCurrencies).filter(([, v]) => v > 0).reduce((prev, [k, v]) => { prev[k] = v; return prev; }, {}));\r\n\r\n\t\tObject.keys(this._loot['currency']).forEach(k => this._loot['currency'][k] = 0);\r\n\t\t$(this._html).find('[data-currency-input').val(0);\r\n\t\tawait this.submit({});\r\n\t}\r\n\r\n\tprotected async _onTakeItem(e) {\r\n\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId} | _onTakeItem`);\r\n\t\tconst token = canvas.tokens.controlled?.[0];\r\n\t\tconst actor = token.actor;\r\n\t\tif (!token || !actor) {\r\n\t\t\tui.notifications.error('You must be controlling only one token to pick up an item');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst itemType = $(e.currentTarget).parents(`ol[data-itemType]`).attr('data-itemType');\r\n\t\tconst itemId = e.currentTarget.dataset.id;\r\n\t\tconst itemData = this._loot?.[itemType]?.find(i => i._id === itemId);\r\n\t\tif (--itemData.qty === 0) {\r\n\t\t\tthis._loot?.[itemType].findSplice(i => i._id === itemId);\r\n\t\t}\r\n\t\tsetProperty(itemData, 'flags.pick-up-stix.pick-up-stix', {\r\n\t\t\tinitialState: { id: itemData._id, count: 1, itemData: { ...itemData, flags: {} } },\r\n\t\t\timageOriginalPath: itemData.img,\r\n\t\t\titemType: ItemType.ITEM,\r\n\t\t\tisLocked: false\r\n\t\t});\r\n\t\tawait createOwnedEntity(actor, [itemData]);\r\n\t\titemCollected(token, itemData);\r\n\r\n\t\tawait this.submit({});\r\n\t}\r\n\r\n\tprotected _onEditImage(e) {\r\n\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId}  | _onEditImage`);\r\n\t\tconst f = new ContainerImageSelectionApplication(this._token).render(true);\r\n\r\n\t\tHooks.once('closeContainerImageSelectionApplication', () => {\r\n\t\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId}  | closeContainerImageSelectionApplication hook`);\r\n\t\t\tthis.submit({});\r\n\t\t});\r\n\t}\r\n\r\n\tprotected async _onDrop(e) {\r\n\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId}  | _onDrop with data:`);\r\n\t\tconst droppedData = JSON.parse(e.dataTransfer.getData('text/plain'));\r\n\t\tconsole.log(droppedData);\r\n\r\n\t\tif (droppedData.type !== \"Item\") {\r\n\t\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId}  | _onDrop | item is not 'Item' type`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet itemData = droppedData.data ?? await game.items.get(droppedData.id)?.data ?? await game.packs.get(droppedData.pack).getEntry(droppedData.id);\r\n\r\n\t\tif (droppedData.actorId) {\r\n\t\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId}  | _onDrop | drop data contains actor ID '${droppedData.actorId}', delete item from actor`);\r\n\t\t\tawait game.actors.get(droppedData.actorId).deleteOwnedItem(droppedData.data._id);\r\n\t\t\titemData = { ...getProperty(itemData, 'flags.pick-up-stix.pick-up-stix.initialState.itemData') };\r\n\t\t}\r\n\r\n\t\tconst itemType = itemData.type;\r\n\r\n\t\tif (!this._loot[itemType]) {\r\n\t\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId}  | _onDrop | no items of type '${itemType}', creating new slot`);\r\n\t\t\tthis._loot[itemType] = [];\r\n\t\t}\r\n\t\tconst existingItem = this._loot[itemType].find(i => i._id === itemData._id);\r\n\t\tif (existingItem) {\r\n\t\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId}  | _onDrop | existing data for type '${itemType}', increase quantity by 1`);\r\n\t\t\texistingItem.qty++;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId}  | _onDrop | existing data for item '${itemData._id}' does not exist, set quantity to 1 and add to slot`);\r\n\t\t\titemData.qty = 1;\r\n\t\t\tthis._loot[itemType].push(itemData);\r\n\t\t}\r\n\t\tawait this.submit({});\r\n\t}\r\n\r\n\tprotected async _updateObject(e, formData) {\r\n\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId} | _onUpdateObject called with args:`);\r\n\t\tformData.img = this._token.getFlag('pick-up-stix', 'pick-up-stix.isOpen') ? this._token.getFlag('pick-up-stix', 'pick-up-stix.imageContainerOpenPath') : this._token.getFlag('pick-up-stix', 'pick-up-stix.imageContainerClosedPath');\r\n\t\tsetProperty(formData, 'flags.pick-up-stix.pick-up-stix.containerLoot', { ...Object.entries(this._loot).reduce((prev, [k, v]) => { if (k === 'currency') return prev; prev[k] = v; return prev;}, {}) });\r\n\t\tconsole.log([e, formData]);\r\n\t\tawait updateToken(this._token, flattenObject(formData));\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tasync close() {\r\n\t\tconsole.log(`pick-up-stix | ItemConfigApplication ${this.appId} | close`);\r\n\t\tHooks.off('updateToken', this._tokenUpdateHandler);\r\n\t\tHooks.off('deleteToken', this._tokenDeletedHandler);\r\n\t\treturn super.close();\r\n\t}\r\n}\r\n"]}